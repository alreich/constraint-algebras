
;(in-package "CONSTRAINT-MAINTENANCE")

;;;---------------------------------------------------------------------------

(define-algebra
    'LINEAR-POINT
    :Documentation "Linear point algebra"
    :Type :constraint-algebra
    :Equalities '((:point . :=) (:pt . :=))
    :Inverse-Relations
    '( :>   :=   :>=  :<   :/=  :<=  :?)
    :Relation-List
    ;; 001  010  011  100  101  110  111
    ;;  1    2    3    4    5    6    7
    '( :<   :=   :<=  :>   :/=  :>=  :?)
    ;;-----------------------------------
    :Multiplication-Table
    '(( 1    1    1    7    7    7    7 )
      ( 1    2    3    4    5    6    7 )
      ( 1    3    3    7    7    7    7 )
      ( 7    4    7    4    7    4    7 )
      ( 7    5    7    7    7    7    7 )
      ( 7    6    7    4    7    6    7 )
      ( 7    7    7    7    7    7    7 )))

;;;---------------------------------------------------------------------------

(define-algebra
    'RIGHT-BRANCHING-POINT
    :Documentation "Right-branching point algebra"
    :Type :constraint-algebra
    :Equalities '((:point . :RB=) (:pt . :RB=))
    :Relation-List
    '(:RB< :RB= :RB<= :RB> :RB<> :RB=> :RB<=> :RB~ :RB<~ :RB=~ :RB<=~ :RB>~ :RB<>~ :RB=>~ :RB<=>~)
    :Inverse-Relations
    '(:RB> :RB= :RB=> :RB< :RB<> :RB<= :RB<=> :RB~ :RB>~ :RB=~ :RB=>~ :RB<~ :RB<>~ :RB<=~ :RB<=>~)
    :Multiplication-Table
    '(( 1  1  1  7  7  7  7  9  9  9  9 15 15 15 15)
      ( 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15)
      ( 1  3  3  7  7  7  7  9  9 11 11 15 15 15 15)
      (15  4 15  4 15  4 15  8 15 12 15 12 15 12 15)
      (15  5 15  7 15  7 15  9 15 13 15 15 15 15 15)
      (15  6 15  4 15  6 15  8 15 14 15 12 15 14 15)
      (15  7 15  7 15  7 15  9 15 15 15 15 15 15 15)
      ( 8  8  8 12 12 12 12 15 15 15 15 15 15 15 15)
      ( 9  9  9 15 15 15 15 15 15 15 15 15 15 15 15)
      ( 9 10 11 12 13 14 15 15 15 15 15 15 15 15 15)
      ( 9 11 11 15 15 15 15 15 15 15 15 15 15 15 15)
      (15 12 15 12 15 12 15 15 15 15 15 15 15 15 15)
      (15 13 15 15 15 15 15 15 15 15 15 15 15 15 15)
      (15 14 15 12 15 14 15 15 15 15 15 15 15 15 15)
      (15 15 15 15 15 15 15 15 15 15 15 15 15 15 15)))

;;;---------------------------------------------------------------------------

(define-algebra
    'LEFT-BRANCHING-POINT
    :Documentation "Left-branching point algebra"
    :Type :constraint-algebra
    :Equalities '((:point . :LB=) (:pt . :LB=))
    :Relation-List
    '(:LB< :LB= :LB<= :LB> :LB<> :LB=> :LB<=> :LB~ :LB<~ :LB=~ :LB<=~ :LB>~ :LB<>~ :LB=>~ :LB<=>~)
    :Inverse-Relations
    '(:LB> :LB= :LB=> :LB< :LB<> :LB<= :LB<=> :LB~ :LB>~ :LB=~ :LB=>~ :LB<~ :LB<>~ :LB<=~ :LB<=>~)
    :Multiplication-Table
    '(( 1  1  1 15 15 15 15  8  9  9  9 15 15 15 15)
      ( 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15)
      ( 1  3  3 15 15 15 15  8  9 11 11 15 15 15 15)
      ( 7  4  7  4  7  4  7 12 15 12 15 12 15 12 15)
      ( 7  5  7 15 15 15 15 12 15 13 15 15 15 15 15)
      ( 7  6  7  4  7  6  7 12 15 14 15 12 15 14 15)
      ( 7  7  7 15 15 15 15 12 15 15 15 15 15 15 15)
      ( 9  8  9  8  9  8  9 15 15 15 15 15 15 15 15)
      ( 9  9  9 15 15 15 15 15 15 15 15 15 15 15 15)
      ( 9 10 11 12 13 14 15 15 15 15 15 15 15 15 15)
      ( 9 11 11 15 15 15 15 15 15 15 15 15 15 15 15)
      (15 12 15 12 15 12 15 15 15 15 15 15 15 15 15)
      (15 13 15 15 15 15 15 15 15 15 15 15 15 15 15)
      (15 14 15 12 15 14 15 15 15 15 15 15 15 15 15)
      (15 15 15 15 15 15 15 15 15 15 15 15 15 15 15)))

;;;---------------------------------------------------------------------------

(defparameter *LINEAR-INTERVAL-ABBREVS*
  '(
    (:before        :B  )
    (:equal         :E  )
    (:after         :BI )
    (:during        :D  )
    (:contains      :DI )
    (:finishes      :F  )
    (:finished-by   :FI )
    (:meets         :M  )
    (:met-by        :MI )
    (:overlaps      :O  )
    (:overlapped-by :OI )
    (:starts        :S  )
    (:started-by    :SI )
    ;;
    ;; ADDITIONAL ABBREVIATIONS:
    ;;
    (:?        (:B :E :BI :D :DI :F :FI :M :MI :O :OI :S :SI))
    (:in       (:D :E :F :S))
    (:disjoint (:B :BI :M :MI))
    ;;
    ;; END POINT RELATIONS OF MATUSZEK, ET AL.
    ;;
    (:sbs                      (:B :DI :FI :M :O))
    (:starts-before-starts     (:B :DI :FI :M :O))
    (:sbf                      (:B :D :DI :E :F :FI :M :O :OI :S :SI))
    (:starts-before-finishes   (:B :D :DI :E :F :FI :M :O :OI :S :SI))
    (:sws                      (:E :S :SI))
    (:starts-when-starts       (:E :S :SI))
    (:swf                      :MI)
    (:starts-when-finishes     :MI)
    (:sas                      (:BI :D :F :MI :OI))
    (:starts-after-starts      (:BI :D :F :MI :OI))
    (:saf                      :BI)
    (:starts-after-finishes    :BI)
    (:fbs                      :B)
    (:finishes-before-starts   :B)
    (:fbf                      (:B :D :M :O :S))
    (:finishes-before-finishes (:B :D :M :O :S))
    (:fws                      :M)
    (:finishes-when-starts     :M)
    (:fwf                      (:E :F :FI))
    (:finishes-when-finishes   (:E :F :FI))
    (:fas                      (:BI :D :DI :E :F :FI :MI :O :OI :S :SI))
    (:finishes-after-starts    (:BI :D :DI :E :F :FI :MI :O :OI :S :SI))
    (:faf                      (:BI :DI :MI :OI :SI))
    (:finishes-after-finishes  (:BI :DI :MI :OI :SI))
    ))

(define-algebra
    'LINEAR-INTERVAL
    :Documentation "Allen's interval algebra"
    :Type :relation-system
    :Equalities '((:interval . :E) (:int . :E) (:period . :E) (:per . :E))
    :Abbreviations *LINEAR-INTERVAL-ABBREVS*
    :Relation-List
    ;;    1      2      4      8     16     32     64    128    256    512   1024   2048   4096
    '(   :B     :E     :BI    :D    :DI     :F    :FI     :M    :MI     :O    :OI     :S    :SI)
    :Inverse-Relations
    '(   :BI    :E     :B     :DI   :D      :FI   :F      :MI   :M      :OI   :O      :SI   :S )
    :Multiplication-Table
    '((   1      1   8191   2697      1   2697      1      1   2697      1   2697      1      1) ; :B
      (   1      2      4      8     16     32     64    128    256    512   1024   2048   4096) ; :E
      (8191      4      4   1324      4      4      4   1324      4   1324      4   1324      4) ; :BI
      (   1      8      4      8   8191      8   2697      1      4   2697   1324      8   1324) ; :D
      ( 721     16   5396   7802     16   5136     16    592   5136    592   5136    592     16) ; :DI
      (   1     32      4      8   5396     32     98    128      4   2568   1284      8   1284) ; :F
      (   1     64   5396   2568     16     98     64    128   5136    512   5136    512     16) ; :FI
      (   1    128   5396   2568      1   2568      1      1     98      1   2568    128    128) ; :M
      ( 721    256      4   1064      4    256    256   6146      4   1064      4   1064      4) ; :MI
      (   1    512   5396   2568    721   2568    641      1   5136    641   7802    512    592) ; :O
      ( 721   1024      4   1064   5396   1024   5136    592      4   7802   1284   1064   1284) ; :OI
      (   1   2048      4      8    721      8    641      1    256    641   1064   2048   6146) ; :S
      ( 721   4096      4   1064     16   1024     16    592    256    592   1024   6146   4096))) ; :SI
  
;;;---------------------------------------------------------------------------

(define-algebra
    'LINEAR-INTERVAL-&-POINT
    :Documentation "Allen's interval algebra with points"
    :Type :relation-system
    :Equalities '((:interval . :=E) (:int . :=E) (:period . :=E) (:per . :=E)
		  (:point . :=PE) (:pt . :=PE))
    :Relation-List
    '(:=B  :=BI :=D  :=DI :=E :=F  :=FI :=M  :=MI :=O  :=OI :=PE :=PF  :=PFI :=PS  :=PSI :=S  :=SI)
    :Inverse-Relations
    '(:=BI :=B  :=DI :=D  :=E :=FI :=F  :=MI :=M  :=OI :=O  :=PE :=PFI :=PF  :=PSI :=PS  :=SI :=S )
    :Multiplication-Table
    '((1 262143 82565 1 1 82565 1 1 82565 1 82565 1 82565 1 1 1 1 1)
      (262143 2 5414 2 2 2 2 5414 2 5414 2 2 2 2 5414 2 5414 2)
      (1 2 4 262143 4 4 82565 1 2 82565 5414 0 0 1 0 2 4 5414)
      (8905 165130 198268 8 8 132104 8 584 132104 584 132104 8 132104 8 584 8 584 8)
      (1 2 4 8 16 32 64 128 256 512 1024 0 0 8192 0 32768 65536 131072)
      (1 2 4 165130 32 32 112 128 2 66052 1282 0 0 8192 0 2 4 1282)
      (1 165130 66052 8 64 112 64 128 132104 512 132104 0 0 8192 0 8 512 8)
      (1 165130 66052 1 128 66052 1 1 112 1 66052 0 0 1 0 8192 128 128)
      (8905 2 1060 2 256 256 256 196624 2 1060 2 0 0 32768 0 2 1060 2)
      (1 165130 66052 8905 512 66052 641 1 132104 641 198268 0 0 1 0 8 512 584)
      (8905 2 1060 165130 1024 1024 132104 584 2 198268 1282 0 0 8 0 2 1060 1282)
      (1 2 4 0 0 0 0 0 0 0 0 2048 4096 0 16384 0 0 0)
      (1 2 4 2 4096 4096 4096 16384 2 4 2 0 0 2048 0 2 4 2)
      (1 165130 66052 0 0 0 0 0 0 0 0 8192 112 0 128 0 0 0)
      (1 2 4 1 16384 4 1 1 4096 1 4 0 0 1 0 2048 16384 16384)
      (8905 2 1060 0 0 0 0 0 0 0 0 32768 256 0 196624 0 0 0)
      (1 2 4 8905 65536 4 641 1 256 641 1060 0 0 1 0 32768 65536 196624)
      (8905 2 1060 8 131072 1024 8 584 256 584 1024 0 0 8 0 32768 196624 131072)))

;;;---------------------------------------------------------------------------

(define-algebra
    'RIGHT-BRANCHING-INTERVAL-&-POINT
    :Documentation "Right-branching interval algebra with points"
    :Type :RELATION-SYSTEM
    :Equalities '((:interval . :=<E) (:int . :=<E) (:period . :=<E) (:per . :=<E)
		  (:point . :=<PE) (:pt . :=<PE))
    :Relation-List
    '(:=<BI :=<RBI :=<B :=<RB :=<D  :=<DI :=<E :=<F  :=<FI :=<R~ :=<M  :=<MI :=<O  :=<RO  :=<OI
      :=<ROI :=<S  :=<SI :=<RS :=<PE :=<PF  :=<PFI :=<PS  :=<PSI)
    :Inverse-Relations
    '(:=<B :=<RB :=<BI :=<RBI :=<DI :=<D  :=<E :=<FI :=<F  :=<R~ :=<MI :=<M  :=<OI :=<ROI :=<O
      :=<RO  :=<SI :=<S  :=<RS :=<PE :=<PFI :=<PF  :=<PSI :=<PS)
    :Multiplication-Table
    '((1 2 16777215 512 1099923 1 1 1 1 512 1099923 1 1099923 2 1 2 1099923 1 2 1 1 1 1099923 1)
      (1 2 512 16777215 2 515 2 2 514 512 512 1 514 1100435 3 1099923 2 3 1099923 0 0 512 0 1)
      (16473589 4568086 4 4 4264980 4 4 4264980 4 524 4 4264980 4 4 4264980 4264980 4 4 4 4 4264980 4 4 4)
      (8841257 520698 8 8 303112 8 8 303112 8 2111276 8 303112 8 8 303112 303112 8 8 8 8 303112 8 8 8)
      (1 2 4 524 16 16473589 16 16 4264980 512 4 1 4264980 4568086 1067153 32786 16 1067153 32786 0 0 4 0 1)
      (8538145 303106 2110764 8 520688 32 32 147488 32 520 12576 147488 12576 8192 147488 303104 12576 32 8192 32 147488 32 12576 32)
      (1 2 4 8 16 32 64 128 256 512 1024 2048 4096 8192 16384 32768 65536 131072 262144 0 0 2097152 0 8388608)
      (1 2 4 520 16 8538145 128 128 448 512 1024 1 69648 303106 18433 32770 16 18433 32770 0 0 2097152 0 1)
      (8538145 303106 4 8 69648 32 256 448 256 520 1024 147488 4096 8192 147488 303104 4096 32 8192 0 0 2097152 0 32)
      (515 1100435 512 512 514 512 512 514 512 16777215 512 514 512 512 514 514 512 512 512 512 514 512 512 512)
      (8538145 303106 4 4 69648 4 1024 69648 4 520 4 448 4 4 69648 69648 1024 1024 1024 0 0 4 0 2097152)
      (1 2 2110764 512 49296 1 2048 2048 2048 512 458816 1 49296 2 1 2 49296 1 2 0 0 8388608 0 1)
      (8538145 303106 4 12 69648 2102564 4096 69648 5124 520 4 147488 5124 13316 217584 372752 4096 4384 12288 0 0 4 0 32)
      (8538145 303106 8 2110764 303104 8232 8192 303104 8200 520 8 147488 8200 12584 450592 520688 8192 8224 12576 0 0 8 0 32)
      (1 2 2110764 520 49296 8538145 16384 16384 147488 512 12576 1 520688 303106 18433 32770 49296 18433 32770 0 0 32 0 1)
      (1 2 8 2111276 32768 8841257 32768 32768 303112 512 8 1 303112 520698 51201 49298 32768 51201 49298 0 0 8 0 1)
      (1 2 4 12 16 2102564 65536 16 5124 512 4 2048 5124 13316 16528 32784 65536 196672 327680 0 0 4 0 8388608)
      (1 2 2110764 8 49296 32 131072 16384 32 512 12576 2048 12576 8192 16384 32768 458816 131072 262144 0 0 32 0 8388608)
      (1 2 8 2110764 32768 8232 262144 32768 8200 512 8 2048 8200 12584 49152 49296 262144 393216 458816 0 0 8 0 8388608)
      (1 2 4 0 16 0 0 0 0 512 0 0 0 0 0 0 0 0 0 524288 1048576 0 4194304 0)
      (1 2 4 512 16 1 1048576 1048576 1048576 512 4194304 1 16 2 1 2 16 1 2 0 0 524288 0 1)
      (8538145 303106 4 0 69648 0 0 0 0 520 0 0 0 0 0 0 0 0 0 2097152 448 0 1024 0)
      (1 2 4 4 16 4 4194304 16 4 512 4 1048576 4 4 16 16 4194304 4194304 4194304 0 0 4 0 524288)
      (1 2 2110764 0 49296 0 0 0 0 512 0 0 0 0 0 0 0 0 0 8388608 2048 0 458816 0)))

;;;---------------------------------------------------------------------------

;;; Left Branching Interval & Point Algebra Definition
;;; Created 12/27/92

(define-algebra
    'LEFT-BRANCHING-INTERVAL-&-POINT
    :Documentation "Left branching interval algebra with points"
    :Type :RELATION-SYSTEM
    :Equalities '((:interval . :>=E) (:int . :>=E) (:period . :>=E) (:per . :>=E)
		  (:point . :>=PE) (:pt . :>=PE))
    :Relation-List
    '(:>=B :>=BI :>=D :>=DI :>=E :>=F :>=FI :>=LB :>=LBI :>=LF :>=LO :>=LOI :>=L~
      :>=M :>=MI :>=O :>=OI :>=PE :>=PF :>=PFI :>=PS :>=PSI :>=S :>=SI)
    :Inverse-Relations
    '(:>=BI :>=B :>=DI :>=D :>=E :>=FI :>=F :>=LBI :>=LB :>=LF :>=LOI :>=LO :>=L~
      :>=MI :>=M :>=OI :>=O :>=PE :>=PFI :>=PF :>=PSI :>=PS :>=SI :>=S)
    :Multiplication-Table
    '((1 16777215 5284997 1 1 5284997 1 128 4096 128 128 128 4096 1 5284997 1 5284997 1 5284997 1 1 1 1 1)
      (16769151 2 344102 2 2 2 2 347814 2 2 344102 2 4354 344102 2 344102 2 2 2 2 344102 2 344102 2)
      (1 2 4 16769151 4 4 5283845 128 4354 1156 1156 347814 4096 1 2 5283845 344102 0 0 1 0 2 4 344102)
      (565321 10569994 12684924 8 8 8456200 8 3712 256 2048 3584 2048 4352 32840 8456200 32840 8456200 8 8456200 8 32840 8 32840 8)
      (1 2 4 8 16 32 64 128 256 512 1024 2048 4096 8192 16384 32768 65536 0 0 524288 0 2097152 4194304 8388608)
      (1 2 4 10567690 32 32 112 128 258 544 1028 83970 4096 8192 2 4227076 81922 0 0 524288 0 2 4 81922)
      (1 10569994 4228100 8 64 624 64 128 256 512 1024 2048 4096 8192 8456200 32768 8456200 0 0 524288 0 8 32768 8)
      (1 4096 128 4225 128 128 129 128 16777215 5284997 5284997 5289093 4096 1 4096 129 4224 0 0 1 0 4096 128 4224)
      (569161 256 3840 256 256 256 256 12685308 256 256 3840 256 10574090 3840 256 3840 256 256 256 256 3840 256 3840 256)
      (1 256 1024 2312 512 512 576 128 10569994 624 4228100 8456456 4096 8192 256 33792 2304 0 0 524288 0 256 1024 2304)
      (1 256 1024 569161 1024 1024 41985 128 10574090 4228228 4228228 12685308 4096 1 256 41985 3840 0 0 1 0 256 1024 3840)
      (565321 256 3584 2312 2048 2048 2056 3712 10569994 8456200 12684924 8456456 4352 32840 256 36424 2304 0 0 8 0 256 3584 2304)
      (4225 4096 4224 4096 4096 4096 4096 5289093 4096 4096 4224 4096 16777215 4224 4096 4224 4096 4096 4096 4096 4224 4096 4224 4096)
      (1 10569994 4228100 1 8192 4228100 1 128 4096 128 128 128 4096 1 624 1 4228100 0 0 1 0 524288 8192 8192)
      (565321 2 65572 2 16384 16384 16384 3712 2 16384 65572 2 4352 12582928 2 65572 2 0 0 2097152 0 2 65572 2)
      (1 10569994 4228100 565321 32768 4228100 40961 128 4352 1152 1152 3712 4096 1 8456200 40961 12684924 0 0 1 0 8 32768 32840)
      (565321 2 65572 10567690 65536 65536 8454152 3712 258 67584 69156 83970 4352 32840 2 12681340 81922 0 0 8 0 2 65572 81922)
      (1 2 4 0 0 0 0 128 0 0 0 0 4096 0 0 0 0 131072 262144 0 1048576 0 0 0)
      (1 2 4 2 262144 262144 262144 128 2 262144 4 2 4096 1048576 2 4 2 0 0 131072 0 2 4 2)
      (1 10569994 4228100 0 0 0 0 128 0 0 0 0 4096 0 0 0 0 524288 624 0 8192 0 0 0)
      (1 2 4 1 1048576 4 1 128 4096 128 128 128 4096 1 262144 1 4 0 0 1 0 131072 1048576 1048576)
      (565321 2 65572 0 0 0 0 3712 0 0 0 0 4352 0 0 0 0 2097152 16384 0 12582928 0 0 0)
      (1 2 4 565321 4194304 4 40961 128 4352 1152 1152 3712 4096 1 16384 40961 65572 0 0 1 0 2097152 4194304 12582928)
      (565321 2 65572 8 8388608 65536 8 3712 256 2048 3584 2048 4352 32840 16384 32840 65536 0 0 8 0 2097152 12582928 8388608)
      ))

;;;---------------------------------------------------------------------------

;;; Duration algebra based on interval arithmetic.

;(define-algebra
;  'DURATION
;  :Documentation "Interval-based duration algebra"
;  :Type :non-discrete-algebra
;  :Element-Type 'im:interval
;;  :Zero-Element	#I(#.most-negative-fixnum #.most-positive-fixnum)
;  :Zero-Element	(im::make-interval :beg #.most-negative-fixnum :end #.most-positive-fixnum)
;  :Multiplication-Function #'im:int*
;  :Addition-Function #'im:int&
;  :Equal-P #'im:int=
;  :Less-Than-P #'im:i<<=               ; <------ INCOMPLETE!
;  :Inverse-Function #'im:int/)

;;;---------------------------------------------------------------------------
;;;                              END OF FILE
;;;---------------------------------------------------------------------------
